# í•œêµ­ ì£¼ì‹ í€€íŠ¸ í¬íŠ¸í´ë¦¬ì˜¤ ì‹œìŠ¤í…œ - ê¸°ìˆ  ë¬¸ì„œ

## ë¬¸ì„œ ê°œìš”

**ë²„ì „**: 10.4
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-02-09
**ì‘ì„±ì**: Claude Opus 4.6

---

## í•µì‹¬ ë³€ê²½ì‚¬í•­ (v10.4 â€” í€€íŠ¸ TOP 5 ìë™ ì¶”ì²œ)

### 2026-02-09 ìœ„í—˜ í”Œë˜ê·¸ ì—°ë™ + ì„¹í„° ë¶„ì‚° ìë™ ì„ ì •

**ë³€ê²½**: í€€íŠ¸ TOP 30ì—ì„œ ìœ„í—˜ í”Œë˜ê·¸ ì œì™¸ + ì„¹í„° ë¶„ì‚°ìœ¼ë¡œ 5ì¢…ëª© ìë™ ì¶”ì²œ

| í•­ëª© | ë‚´ìš© |
|------|------|
| ìœ„í—˜ í”Œë˜ê·¸ ì—°ë™ | AI ë¸Œë¦¬í•‘ì˜ `compute_risk_flags()` ì¬ì‚¬ìš© â†’ ìœ„í—˜ ì¢…ëª© ìë™ ì œì™¸ |
| ì„¹í„° ë¶„ì‚° | `get_broad_sector()` ëŒ€ë¶„ë¥˜ (ë°˜ë„ì²´/ìë™ì°¨/ë°”ì´ì˜¤/ê²Œì„/ì—”í„°) |
| ì§„ì… ì „ëµ | RSI<40 ì¦‰ì‹œ(ê³¼ë§¤ë„), <60 ì¦‰ì‹œ, <70 ë¶„í• , â‰¥70 ëŒ€ê¸° |
| ë¹„ì¤‘ | 25/25/20/15/15% (ìˆœìœ„ ê¸°ë°˜ ê³ ì •) |
| ì „ì†¡ | ë³„ë„ ë©”ì‹œì§€ë¡œ ì±„ë„+ê°œì¸ë´‡ ì „ì†¡ |

**ì„ ì • ë¡œì§**:
```
í†µí•©ìˆœìœ„ 1ìœ„ë¶€í„° ìˆœíšŒ:
  â†’ compute_risk_flags() ìˆìœ¼ë©´ ìŠ¤í‚µ (SOOP -51% ê¸‰ë½, ì œë£¡ì „ê¸° -8.7% ê¸‰ë½ ë“±)
  â†’ ê°™ì€ ëŒ€ë¶„ë¥˜ ì„¹í„° ì´ë¯¸ ìˆìœ¼ë©´ ìŠ¤í‚µ (SKí•˜ì´ë‹‰ìŠ¤ â†’ ë°˜ë„ì²´ ì¤‘ë³µ)
  â†’ 5ì¢…ëª© ì±„ì›Œì§ˆ ë•Œê¹Œì§€ ë°˜ë³µ
```

**ìˆ˜ì • íŒŒì¼**:
1. `send_telegram_auto.py` â€” `select_top5()`, `format_recommendation()`, TOP 5 ì „ì†¡ ë¸”ë¡ ì¶”ê°€

---

## í•µì‹¬ ë³€ê²½ì‚¬í•­ (v10.3 â€” AI ë¸Œë¦¬í•‘ v3 ì •ëŸ‰ ë¦¬ìŠ¤í¬ ìŠ¤ìºë„ˆ)

### 2026-02-09 í•´ì™¸ í”„ë¡œì íŠ¸ êµ¬ì¡° ì ìš©

**ë³€ê²½**: AI ë¸Œë¦¬í•‘ì„ "ì •ëŸ‰ ë¦¬ìŠ¤í¬ ìŠ¤ìºë„ˆ" êµ¬ì¡°ë¡œ ì „ë©´ ê°œí¸ (eps-momentum-us ì°¸ì¡°)

| í•­ëª© | Before (v10.2) | After (v10.3) |
|------|----------------|---------------|
| ìœ„í—˜ ê°ì§€ | 5ê°œ ë‹¨ìˆœ alert (RSI/52ì£¼/ì „ì¼ë¹„) | **6ê°œ ì •ëŸ‰ í”Œë˜ê·¸** (ì½”ë“œ ê³„ì‚°) |
| í”„ë¡¬í”„íŠ¸ | raw ë°ì´í„° + alert ì „ë‹¬ | **ì¢…ëª©ë³„ ì¸ë¼ì¸ í”Œë˜ê·¸ + ì„¤ëª… ì„¹ì…˜** |
| ì¶œë ¥ í¬ë§· | plain text | **Telegram HTML** (bold, ë¶„ë¦¬ì„ ) |
| ì¢…ëª© êµ¬ë¶„ | ì—†ìŒ | **[SEP] â†’ â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë¶„ë¦¬ì„ ** |
| âœ… í´ë¦° ë¦¬ìŠ¤íŠ¸ | Gemini ìƒì„± (í¬ë§· ë¶ˆì•ˆì •) | **ì½”ë“œ ì§ì ‘ ìƒì„±** |
| temperature | 0.3 ê³ ì • | **0.2 â†’ ì‹¤íŒ¨ì‹œ 0.3 ì¬ì‹œë„** |
| ì‘ë‹µ ì¶”ì¶œ | response.text ì§ì ‘ | **extract_text() í—¬í¼** |

**6ê°€ì§€ ìœ„í—˜ í”Œë˜ê·¸**:
- ğŸ”º ê³¼ë§¤ìˆ˜ (RSIâ‰¥75) | ğŸ“‰ 52ì£¼ ê¸‰ë½ (â‰¤-35%) | âš ï¸ ì „ì¼ ê¸‰ë½ (â‰¤-5%)
- ğŸ”º ì „ì¼ ê¸‰ë“± (â‰¥+8%) | ğŸ’° ê³ í‰ê°€ (PER>40) | ğŸ“Š ê±°ë˜ëŸ‰ í­ë°œ (â‰¥3ë°°)

**ìˆ˜ì • íŒŒì¼**:
1. `gemini_analysis.py` â€” compute_risk_flags(), build_prompt() ì¬ì‘ì„±, convert_markdown_to_html(), extract_text()
2. `send_telegram_auto.py` â€” AI ë¸Œë¦¬í•‘ parse_mode='HTML', TOP20 ì¢…ëª©ê°„ ì—¬ë°± ì¶•ì†Œ

---

## í•µì‹¬ ë³€ê²½ì‚¬í•­ (v10.2 â€” í¬íŠ¸í´ë¦¬ì˜¤ í’ˆì§ˆ ê°œì„ )

### 2026-02-09 ìœ ë‹ˆë²„ìŠ¤ ê°•í™” + ë©€í‹°íŒ©í„° ë¹„ì¤‘ ì¡°ì • + AI ë¸Œë¦¬í•‘ ì±„ë„ ì „ì†¡

**ë¬¸ì œ**: ì¡ì£¼(ì œë‹‰ PBR 8.2, ì•„ì´í‹°ì„¼ê¸€ë¡œë²Œ PER 247)ê°€ TOP 10ì— ì§„ì…
**ê·¼ë³¸ ì›ì¸**: Quality(ROE) 40%ê°€ Value 40%ë¥¼ ìƒì‡„ â†’ "ë¹„ì‹¸ì§€ë§Œ ROE ë†’ì€" ì¢…ëª©ì´ ìƒìœ„ ì§„ì…

| í•­ëª© | Before (v3.1) | After (v3.2) |
|------|---------------|--------------|
| ì‹œê°€ì´ì•¡ í•˜í•œ | 1000ì–µ | **3000ì–µ** |
| ê±°ë˜ëŒ€ê¸ˆ í•˜í•œ | 30ì–µ | **50ì–µ** |
| PER ìƒí•œ | ì—†ìŒ | **60** |
| PBR ìƒí•œ | ì—†ìŒ | **10** |
| Value ë¹„ì¤‘ | 40% | **50%** |
| Quality ë¹„ì¤‘ | 40% | **30%** |
| Momentum ë¹„ì¤‘ | 20% | 20% |
| Fallback (V/Q) | 50/50 | **60/40** |
| AI ë¸Œë¦¬í•‘ ì „ì†¡ | ê°œì¸ë´‡ì—ë§Œ | **ì±„ë„+ê°œì¸ë´‡** |

**íš¨ê³¼**: ìœ ë‹ˆë²„ìŠ¤ ~775ê°œ â†’ ~450ê°œ, PER/PBR í•„í„°ë¡œ 152ì¢…ëª© ì¶”ê°€ ì œê±°, ì¡ì£¼ ì „ë¶€ íƒˆë½

**ìˆ˜ì • íŒŒì¼**:
1. `create_current_portfolio.py` â€” ìœ ë‹ˆë²„ìŠ¤ defaults + 3.6ë‹¨ê³„ PER/PBR í•„í„°
2. `strategy_b_multifactor.py` â€” Value 50% / Quality 30% / Momentum 20%
3. `config_template.py` â€” PER_MAX_LIMIT, PBR_MAX_LIMIT ì¶”ê°€
4. `send_telegram_auto.py` â€” AI ë¸Œë¦¬í•‘ ì±„ë„+ê°œì¸ë´‡ ì „ì†¡ + SECTOR_DB 19ì¢…ëª© ì¶”ê°€

---

## í•µì‹¬ ë³€ê²½ì‚¬í•­ (v9.0 â€” Gemini AI ë¸Œë¦¬í•‘)

### 2026-02-08 AI ë¦¬ìŠ¤í¬ ìŠ¤ìºë„ˆ â†’ AI ë¸Œë¦¬í•‘ ì „í™˜

**êµí›ˆ: Gemini Search Grounding í•œê³„**

| ì‹œë„ | ë°©ì‹ | ê²°ê³¼ |
|------|------|------|
| 1ì°¨ | 30ì¢…ëª© ê°œë³„ ê²€ìƒ‰ ìš”ì²­ | 5-8ê°œë§Œ ì‹¤ì œ ê²€ìƒ‰, ë‚˜ë¨¸ì§€ í• ë£¨ì‹œë„¤ì´ì…˜ |
| 2ì°¨ | 5ì¢…ëª©ì”© ë°°ì¹˜ | ì—¬ì „íˆ ì¼ë¶€ë§Œ ê²€ìƒ‰ |
| 3ì°¨ | temperature 0.2 | ë¹ˆ ì‘ë‹µ ë¹ˆë²ˆ |
| 4ì°¨ | temperature 0.5 | ê²€ìƒ‰ ì•ˆ ë˜ë©´ í• ë£¨ì‹œë„¤ì´ì…˜ |
| **ìµœì¢…** | **"ê²€ìƒ‰ì€ ì½”ë“œê°€, ë¶„ì„ì€ AIê°€"** | **ì•ˆì •ì  ì‘ë™** |

**ê·¼ë³¸ ì›ì¸**: Google Search Groundingì€ ìš”ì²­ë‹¹ 5-8ê°œ ê²€ìƒ‰ ì¿¼ë¦¬ë§Œ ìƒì„±. 30ê°œ ì¢…ëª© ê°œë³„ ê²€ìƒ‰ì€ êµ¬ì¡°ì ìœ¼ë¡œ ë¶ˆê°€ëŠ¥.

**í•´ê²° ì›ì¹™: "ê²€ìƒ‰ì€ ì½”ë“œê°€, ë¶„ì„ì€ AIê°€"**

| ì—­í•  | ë‹´ë‹¹ | ë‚´ìš© |
|------|------|------|
| ë°ì´í„° ìˆ˜ì§‘ | ì½”ë“œ | PER/PBR/ROE/RSI/52ì£¼ìœ„ì¹˜/ì „ì¼ë¹„ |
| ì£¼ì˜ ì‹ í˜¸ ê°ì§€ | ì½”ë“œ | RSI â‰¥80/â‰¤25, 52ì£¼ â‰¤-40%, ì „ì¼ â‰¤-7%/â‰¥10% |
| ì‹œì¥ ë™í–¥ | AI (1ê°œ ê²€ìƒ‰) | Google Search 1íšŒ (ê´‘ë²”ìœ„ ì¿¼ë¦¬ â†’ ì•ˆì •ì ) |
| ë°ì´í„° í•´ì„ | AI | ì„¹í„° í¸ì¤‘, ë°¸ë¥˜ì—ì´ì…˜, ëª¨ë©˜í…€ íŒ¨í„´ ë¶„ì„ |

**1. gemini_analysis.py (v2 â€” ë¸Œë¦¬í•‘ ëª¨ë“ˆ)**

| í•­ëª© | Before (ë¦¬ìŠ¤í¬ ìŠ¤ìºë„ˆ) | After (AI ë¸Œë¦¬í•‘) |
|------|----------------------|-------------------|
| AI ëª¨ë¸ | Gemini 2.5 Flash (temp=0.2) | Gemini 2.5 Flash (**temp=0.3**) |
| ê²€ìƒ‰ | 30ì¢…ëª© ê°œë³„ ë‰´ìŠ¤ ê²€ìƒ‰ | **ì‹œì¥ ë™í–¥ 1íšŒë§Œ ê²€ìƒ‰** |
| ë°ì´í„° | AIê°€ ê²€ìƒ‰ìœ¼ë¡œ ìˆ˜ì§‘ | **ì½”ë“œê°€ êµ¬ì„±í•´ì„œ ì „ë‹¬** |
| ì£¼ì˜ ê°ì§€ | AI íŒë‹¨ | **ì½”ë“œ ê¸°ë°˜ (RSI/52ì£¼/ì „ì¼ë¹„)** |
| í”„ë¡¬í”„íŠ¸ | ì†Œê±°ë²• ë¦¬ìŠ¤í¬ ìŠ¤ìºë„ˆ | **ë°ì´í„° í•´ì„ ë¸Œë¦¬í•‘** |
| ì¶œë ¥ | ğŸ“°ì‹œì¥/ğŸš«ì£¼ì˜/ğŸ“…ì‹¤ì /âœ…ë¯¸ë°œê²¬ | **ğŸ“°ì‹œì¥/âš ï¸ì£¼ì˜/ğŸ“ŠíŠ¹ì§•** |
| ë¹ˆ ì‘ë‹µ | ë¯¸ì²˜ë¦¬ | **ì¬ì‹œë„ 1íšŒ + finish_reason ë¡œê·¸** |
| ì „ì†¡ ëŒ€ìƒ | ì±„ë„+ê°œì¸ë´‡ | **ì±„ë„+ê°œì¸ë´‡** (v10.2ì—ì„œ ë³µì›) |

**2. ì—°ë™ êµ¬ì¡°**

```
create_current_portfolio.py â†’ portfolio CSV
send_telegram_auto.py â†’ í¬íŠ¸í´ë¦¬ì˜¤ ë©”ì‹œì§€ ì „ì†¡ (ì±„ë„+ê°œì¸ë´‡)
  â†’ gemini_analysis.run_ai_analysis(None, stock_list)
  â†’ ì½”ë“œê°€ ë°ì´í„° êµ¬ì„± â†’ AIê°€ í•´ì„
  â†’ AI ë¸Œë¦¬í•‘ ì±„ë„+ê°œì¸ë´‡ ì „ì†¡
```

**3. ì¢…ëª©ë³„ ë‰´ìŠ¤ ì œê±°**

| í•­ëª© | Before | After |
|------|--------|-------|
| Google News RSS | ì¢…ëª©ë³„ í¬ë¡¤ë§ (30íšŒ) | **ì™„ì „ ì œê±°** |
| ì„¼í‹°ë¨¼íŠ¸ ë¶„ì„ | í‚¤ì›Œë“œ ê¸°ë°˜ (ë¶€ì •í™•) | **ì œê±°** |
| ë¶€ë¶„ ë§¤ì¹­ ë¬¸ì œ | "ì œë‹‰"â†’"í‚¤í† ì œë‹‰" ì˜¤ë§¤ì¹­ | **í•´ê²° (ì œê±°)** |
| ë©”ì‹œì§€ í¬ê¸° | 3389ì (ë¶„í•  í•„ìš”) | **2838ì (ë‹¨ì¼)** |

**4. GitHub Actions ì—°ë™**

- `GEMINI_API_KEY` GitHub Secret ì¶”ê°€
- `google-genai` pip install ì¶”ê°€
- config.py ìƒì„± ì‹œ GEMINI_API_KEY í¬í•¨

---

## í•µì‹¬ ë³€ê²½ì‚¬í•­ (v8.0 â€” v3.1 ì „ëµ ì•„í‚¤í…ì²˜)

### 2026-02-07 ì „ëµ êµ¬ì¡° ê°œí¸ + ê°€ì¤‘TTM + ê³µë™ìˆœìœ„ ì œê±°

**1. Aâ†’í•„í„°, Bâ†’ìŠ¤ì½”ì–´ë§, A30%+B70% í†µí•©ìˆœìœ„**

| í•­ëª© | Before (v3.0) | After (v3.1) |
|------|---------------|--------------|
| Strategy A | 30ì¢…ëª© ì„ ì • | **150ì¢…ëª© ì‚¬ì „ í•„í„°** |
| Strategy B | 30ì¢…ëª© ì„ ì • | **150ì¢…ëª© ì „ì²´ ìŠ¤ì½”ì–´ë§** |
| ìµœì¢… ì„ ì • | Aâˆ©B êµì§‘í•© | **A30%+B70% í†µí•©ìˆœìœ„ TOP 30** |
| ì¶œë ¥ | strategy_a/b.csv ë¶„ë¦¬ | **portfolio_YYYY_MM.csv í†µí•©** |
| TTM | ê· ë“± í•©ì‚° | **ê°€ì¤‘TTM (40/30/20/10%)** |
| í…”ë ˆê·¸ë¨ | 3ê°œ ë©”ì‹œì§€ (êµì§‘í•©+A+B) | **1~2ê°œ ë©”ì‹œì§€ (TOP 20 ìƒì„¸)** |
| ìˆœìœ„ | `method='average'` (ê³µë™ìˆœìœ„) | **`method='first'` (ê³ ìœ ìˆœìœ„)** |
| pykrx | ë¯¸í™œìš© | **PER/PBR/DIV ì‹¤ì‹œê°„ ìš°ì„ ** |

**2. ê°€ì¤‘ TTM (fnguide_crawler.py)**

```python
# ì†ìµê³„ì‚°ì„œ/í˜„ê¸ˆíë¦„í‘œ: ìµœì‹  ë¶„ê¸° ê°€ì¤‘ì¹˜ ë†’ìŒ
# weights: 1.6(40%), 1.2(30%), 0.8(20%), 0.4(10%) â†’ í•© 4.0 (ê¸°ì¡´ TTM ìŠ¤ì¼€ì¼ ìœ ì§€)
weight_map = {ìµœì‹ : 1.6, 2ë²ˆì§¸: 1.2, 3ë²ˆì§¸: 0.8, 4ë²ˆì§¸: 0.4}
```
â†’ ë¸Œì´í‹° ê°™ì€ ìµœê·¼ ì‹¤ì  ì•…í™” ì¢…ëª©ì´ ìˆœìœ„ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ í•˜ë½

**3. ë‰´ìŠ¤ í•„í„°ë§ + TOP 20 + SECTOR_DB í™•ì¥**

- `is_relevant()`: ì±„ìš©ê³µê³ , ë‹¤ì¢…ëª©ë‚˜ì—´(Â·Ã—3), ì¢…ëª©ëª… ë¯¸í¬í•¨ ë‰´ìŠ¤ ì œì™¸
- TOP 10 â†’ TOP 20 ìƒì„¸ í‘œì‹œ, 3800ì ì´ˆê³¼ì‹œ ë©”ì‹œì§€ ë¶„í• 
- SECTOR_DB 40+ ì¢…ëª© í™•ì¥ (ê¸°íƒ€â†’êµ¬ì²´ì  ì—…ì¢…ëª…)

---

## í•µì‹¬ ë³€ê²½ì‚¬í•­ (v7.1 ì½”ë“œ ì •ë¦¬)

### 2026-02-07 Git ìºì‹œ ì •ë¦¬ + DART ì œê±°

**Git ìºì‹œ ì •ë¦¬**: 2,261ê°œ ì œê±°, fs_fnguide 743ê°œ ìœ ì§€

**DART API ì™„ì „ ì œê±°**: `dart_api.py` ì‚­ì œ, configì—ì„œ DART_API_KEY ì œê±°

---

## í•µì‹¬ ë³€ê²½ì‚¬í•­ (v7.0 GitHub Actions ì™„ì „ ìë™í™”)

### 2026-02-06 GitHub Actions ìˆ˜ì •

**ë¬¸ì œ**: GitHub Actionsì—ì„œ ëª¨ë“ˆ ëˆ„ë½ ë° íƒ€ì„ì¡´ ë¬¸ì œ

| ìˆ˜ì • í•­ëª© | ë¬¸ì œ | í•´ê²° |
|----------|------|------|
| íƒ€ì„ì¡´ | UTCë¡œ ì‹¤í–‰ë˜ì–´ ë‚ ì§œ ì˜¤ë¥˜ | **KST íƒ€ì„ì¡´ ëª…ì‹œì  ì²˜ë¦¬** |
| ì›Œí¬í”Œë¡œìš° | CSV ìƒì„± ë‹¨ê³„ ëˆ„ë½ | **create_current_portfolio.py ë‹¨ê³„ ì¶”ê°€** |
| ì˜ì¡´ì„± | tqdm, scipy ëˆ„ë½ | **pip installì— ì¶”ê°€** |
| íŒŒì¼ ëˆ„ë½ | error_handler.py ë¯¸ì»¤ë°‹ | **GitHubì— ì¶”ê°€** |
| ë¦¬ë°¸ëŸ°ì‹± ì›” | 3/6/9/12ì›” (ì˜ëª»ë¨) | **4/5/8/11ì›”ë¡œ ìˆ˜ì •** |

**KST íƒ€ì„ì¡´ ì²˜ë¦¬**:
```python
from zoneinfo import ZoneInfo
KST = ZoneInfo('Asia/Seoul')

def get_korea_now():
    return datetime.now(KST)

TODAY = get_korea_now().strftime('%Y%m%d')
BASE_DATE = get_previous_trading_date(TODAY)
```

**GitHub Actions ì›Œí¬í”Œë¡œìš°** (telegram_daily.yml):
```yaml
- name: Install dependencies
  run: |
    pip install pykrx pandas numpy requests beautifulsoup4 lxml pyarrow tqdm scipy html5lib google-genai

- name: Generate portfolio (create CSV)
  run: python create_current_portfolio.py

- name: Send Telegram message
  run: python send_telegram_auto.py
```

**ë°ì´í„° ì†ŒìŠ¤**:
- ì¬ë¬´ì œí‘œ: FnGuide ìºì‹œ (Q3 2025 ê³ ì •)
- ì‹œê°€ì´ì•¡: pykrx ì‹¤ì‹œê°„
- OHLCV: pykrx ì‹¤ì‹œê°„

---

## í•µì‹¬ ë³€ê²½ì‚¬í•­ (v6.5 OHLCV ìºì‹œ ë¡œì§ ê°œì„ )

### 2026-02-05 ë²„ê·¸ ìˆ˜ì •

**ìˆ˜ì •ëœ íŒŒì¼**: `create_current_portfolio.py`

| ìˆ˜ì • í•­ëª© | Before | After |
|----------|--------|-------|
| OHLCV ë©”ì„œë“œ | `get_ohlcv_parallel` (ì—†ëŠ” ë©”ì„œë“œ) | `get_all_ohlcv` |
| ìºì‹œ ê²€ì¦ | ìºì‹œ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ ì‚¬ìš© | **BASE_DATE ë°ì´í„° ì¡´ì¬ í™•ì¸** |

**OHLCV ìºì‹œ ë¡œì§ ê°œì„ **:
```python
# Before: ìºì‹œ ìˆìœ¼ë©´ ê·¸ëƒ¥ ì‚¬ìš© (BASE_DATE ë°ì´í„° ì—†ì–´ë„)
if ohlcv_cache_files:
    price_df = pd.read_parquet(ohlcv_cache_file)

# After: BASE_DATE ë°ì´í„°ê°€ ìºì‹œì— ìˆëŠ”ì§€ í™•ì¸
if ohlcv_cache_files:
    price_df = pd.read_parquet(ohlcv_cache_file)
    base_date_dt = pd.Timestamp(datetime.strptime(BASE_DATE, '%Y%m%d'))
    if base_date_dt in price_df.index:
        # ìºì‹œ ì‚¬ìš©
    else:
        # ìƒˆë¡œ ìˆ˜ì§‘
```

**íš¨ê³¼**:
- ë§¤ì¼ ì‹¤í–‰ ì‹œ BASE_DATE ë°ì´í„°ê°€ ìºì‹œì— ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ìƒˆë¡œ ìˆ˜ì§‘
- ì¼ê´€ëœ ê²°ê³¼ ë³´ì¥ (ê°™ì€ BASE_DATEë©´ ê°™ì€ ê²°ê³¼)
- GitHub Actionsì™€ ë¡œì»¬ ì‹¤í–‰ ê²°ê³¼ ë™ì¼

### GitHub Actions ì‹¤í–‰ íë¦„ (v7.0+)

```
1. checkout â†’ ìµœì‹  ì½”ë“œ pull
2. create_current_portfolio.py â†’ portfolio_YYYY_MM.csv ìƒì„±
3. send_telegram_auto.py â†’ CSV ì½ì–´ì„œ í…”ë ˆê·¸ë¨ ì „ì†¡
```

**ì°¸ê³ **: v7.0ë¶€í„° GitHub Actionsì—ì„œ ë§¤ë²ˆ CSVë¥¼ ìƒˆë¡œ ìƒì„±í•˜ë¯€ë¡œ, CSV ì»¤ë°‹ì´ ë¶ˆí•„ìš”.

---

## í•µì‹¬ ë³€ê²½ì‚¬í•­ (v3.2 ì§„ì…ì ìˆ˜ ê°œì„ )

### 2026-02-05 í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì™„ì „ ìë™í™” + ì§„ì…ì ìˆ˜ ê°œì„ 

**ëª©í‘œ**: "ì¢‹ì€ ì‚¬ê³¼ë¥¼ ì‹¸ê²Œ ì‚¬ì" - í• ì¸ëœ ì¢…ëª© ìš°ì„ 

| ë³€ê²½ í•­ëª© | Before | After |
|----------|--------|-------|
| ë‚ ì§œ | í•˜ë“œì½”ë”© | **ìë™ ê°ì§€ (ì „ì¼ ê±°ë˜ì¼ ê¸°ì¤€)** |
| ê¸°ìˆ ì§€í‘œ | ìˆ˜ë™ ì…ë ¥ | **pykrx ì‹¤ì‹œê°„ ê³„ì‚°** |
| ì„ ì •ì´ìœ  | ìˆ˜ë™ ì‘ì„± | **ë°ì´í„° ê¸°ë°˜ ìë™ ìƒì„±** |
| ë¦¬ìŠ¤í¬ | ìˆ˜ë™ ì‘ì„± | **ì§€í‘œ ê¸°ë°˜ ìë™ ìƒì„±** |
| ì‹ ê³ ê°€ ëŒíŒŒ | **ë³´ë„ˆìŠ¤ +35ì ** | **ì¤‘ë¦½ (ê°ì  ì•ˆ í•¨)** |

**ì‹ ê·œ ëª¨ë“ˆ**:
- `send_telegram_auto.py` - ì™„ì „ ìë™í™” í…”ë ˆê·¸ë¨ ì „ì†¡

**ë‚ ì§œ ë¡œì§**:
```
TODAY = ì˜¤ëŠ˜ ë‚ ì§œ (ì¸ì‚¬ìš©)
BASE_DATE = ì „ì¼ ê±°ë˜ì¼ (ë¶„ì„ ê¸°ì¤€)
â†’ ì¥ ì‹œì‘ ì „ ì „ì¼ ì¢…ê°€ ë¶„ì„í•˜ì—¬ ë‹¹ì¼ ë§¤ë§¤ ì „ëµ ìˆ˜ë¦½
```

**ë‰´ìŠ¤ ìë™í™”** (Google News RSS):
```
í¬ë¡¤ë§ â†’ í•„í„°ë§ â†’ ì •ì œ â†’ í‘œì‹œ

í•„í„°ë§ ê·œì¹™ (ì‹œì„¸ ë‰´ìŠ¤ ì œì™¸):
- "+X% ìƒìŠ¹/í•˜ë½", "VI ë°œë™"
- "ìƒìŠ¹í­ í™•ëŒ€/ì¶•ì†Œ", "í•˜ë½í­ í™•ëŒ€/ì¶•ì†Œ"
- "ì£¼ê°€ Xì›” Xì¼", "X% ìƒìŠ¹ ë§ˆê°"
- "ì£¼ê°€.*ì¥ì¤‘", "ì¥ì¤‘.*ì£¼ê°€"

ì •ì œ ê·œì¹™:
- ì¢…ëª©ëª… + ì¡°ì‚¬ ì œê±° (ë„/ëŠ”/ê°€/ì´/ì„/ë¥¼/ì˜/ì—)
- ì–¸ë¡ ì‚¬ëª…, [íƒœê·¸] ì œê±°
- ë¹ˆ ë”°ì˜´í‘œ(''), ì—°ì† íŠ¹ìˆ˜ë¬¸ì(Â·Â·) ì •ë¦¬
- í—¤ë“œë¼ì¸ 35ì ì œí•œ

í‘œì‹œ í˜•ì‹:
ğŸ“° ì£¼ìš”ë‰´ìŠ¤: ë§ˆìŠ¤í¬íŒ© ì¸ê¸°ì— 1ë…„ ìƒˆ 15ë°° ë›´
ğŸ“° ì£¼ìš”ë‰´ìŠ¤: âš ï¸ì‚¼ì„±ì „ì HBM4 ìˆ˜ìœ¨ ê²©ì°¨ 1.5ë°°â€¦ (ë¶€ì •ì )

ìë™í™” í•œê³„:
- ê·œì¹™ ê¸°ë°˜ í•„í„°ë§ (80~90% ì •í™•ë„)
- ìƒˆë¡œìš´ íŒ¨í„´ì˜ ì‹œì„¸ ë‰´ìŠ¤ëŠ” í•„í„° ëª» í•¨
- ë©°ì¹  ì‚¬ìš© í›„ í‰ê°€ ì˜ˆì •
```

**2ë‹¨ê³„ ì „ëµ ì‹œìŠ¤í…œ**:
```
[1ë‹¨ê³„] ë°¸ë¥˜ - ë­˜ ì‚´ê¹Œ?
â€¢ ìœ ë‹ˆë²„ìŠ¤: ê±°ë˜ëŒ€ê¸ˆ 30ì–µâ†‘ (20ì¼ í‰ê· )
â€¢ ì „ëµA ë§ˆë²•ê³µì‹ 30ê°œ âˆ© ì „ëµB ë©€í‹°íŒ©í„° 30ê°œ
â€¢ ê³µí†µì¢…ëª© ì„ ì • (ë™ì ìœ¼ë¡œ ë³€ë™)

[2ë‹¨ê³„] ê°€ê²© - ì–¸ì œ ì‚´ê¹Œ?
â€¢ ì§„ì…ì ìˆ˜ë¡œ ì •ë ¬ (RSIâ†“ 52ì£¼ì €ì â†“ ê±°ë˜ëŸ‰â†‘)
```

**ì§„ì…ì ìˆ˜ ê³„ì‚° (100ì  ë§Œì )** - "ì‹¸ê²Œ ì‚¬ì" ì² í•™:
```
RSI (40ì ): ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ
  - â‰¤30: 40ì  (ê³¼ë§¤ë„ - ìµœê³  ê¸°íšŒ)
  - 31-50: 30ì  (ì–‘í˜¸)
  - 51-70: 20ì  (ì¤‘ë¦½)
  - >70 + ì‹ ê³ ê°€ëŒíŒŒ: 20ì  (ê°ì  ì•ˆ í•¨)
  - >70 ì¼ë°˜: 10ì  (ê³¼ë§¤ìˆ˜ ìœ„í—˜)

52ì£¼ìœ„ì¹˜ (30ì ): í• ì¸ í´ìˆ˜ë¡ ì¢‹ìŒ
  - â‰¤-20%: 30ì  (í° í• ì¸)
  - -10~-20%: 25ì 
  - -5~-10%: 20ì 
  - ì‹ ê³ ê°€ëŒíŒŒ: 15ì  (ê°ì  ì•ˆ í•¨, ë³´ë„ˆìŠ¤ë„ ì—†ìŒ)
  - ê¸°íƒ€: 15ì 

ê±°ë˜ëŸ‰ (20ì ): ìŠ¤íŒŒì´í¬ í™•ì¸
  - â‰¥1.5x: 20ì 
  - ì¼ë°˜: 10ì 

ê¸°ë³¸ (10ì ): í†µê³¼ ì¢…ëª© ê¸°ë³¸ ì ìˆ˜
```

---

## í•µì‹¬ ë³€ê²½ì‚¬í•­ (v3.0 ë¦¬íŒ©í† ë§)

### 2026-02-03 ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§

**ëª©í‘œ**: ëŸ°íƒ€ì„ 50ë¶„ â†’ 5ë¶„ ë‹¨ì¶•

| ë³€ê²½ í•­ëª© | Before | After |
|----------|--------|-------|
| ì¬ë¬´ì œí‘œ ì†ŒìŠ¤ | FnGuide í¬ë¡¤ë§ | **FnGuide ìºì‹œ** |
| ì²˜ë¦¬ ë°©ì‹ | ìˆœì°¨ ì²˜ë¦¬ | **ThreadPool ë³‘ë ¬** |
| ì—ëŸ¬ ì²˜ë¦¬ | print + ë¬´ì‹œ | **Skip & Log íŒ¨í„´** |
| ê±°ë˜ëŒ€ê¸ˆ í•„í„° | 10ì–µì› (ë‹¹ì¼) | **30ì–µì› (20ì¼ í‰ê· )** |
| ì´ ì†Œìš”ì‹œê°„ | ~50ë¶„ | **~35ì´ˆ (ìºì‹œ)** |

**ì‹ ê·œ ëª¨ë“ˆ**:
- `error_handler.py` - Skip & Log ì—ëŸ¬ ì²˜ë¦¬

**ìˆ˜ì • ëª¨ë“ˆ**:
- `fnguide_crawler.py` - ì¬ë¬´ì œí‘œ ìºì‹œ + ê°€ì¤‘TTM + ì»¨ì„¼ì„œìŠ¤
- `data_collector.py` - ThreadPool ë³‘ë ¬ ì²˜ë¦¬ ì¶”ê°€
- `create_current_portfolio.py` - ë™ê¸° main() êµ¬ì¡°

---

## 1. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ë°ì´í„° ìˆ˜ì§‘ ë ˆì´ì–´                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  pykrx API                        â”‚  FnGuide                          â”‚
â”‚  - ì‹œê°€ì´ì•¡ (ë³‘ë ¬)                 â”‚  - ì¬ë¬´ì œí‘œ (ìºì‹œ, ê°€ì¤‘TTM)       â”‚
â”‚  - OHLCV (ë³‘ë ¬)                   â”‚                                   â”‚
â”‚  - PER/PBR/DIV (ì‹¤ì‹œê°„)           â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì „ëµ ë ˆì´ì–´                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Strategy A (ë§ˆë²•ê³µì‹) â†’ ì‚¬ì „ í•„í„° 150ì¢…ëª©                            â”‚
â”‚  - ì´ìµìˆ˜ìµë¥  (EBIT/EV) + íˆ¬í•˜ìë³¸ìˆ˜ìµë¥  (ROC)                       â”‚
â”‚                                                                      â”‚
â”‚  Strategy B (ë©€í‹°íŒ©í„°) â†’ 150ì¢…ëª© ì „ì²´ ìŠ¤ì½”ì–´ë§                        â”‚
â”‚  - Value 50% (PER/PBR ì‹¤ì‹œê°„, PCR, PSR, DIV ì‹¤ì‹œê°„)                  â”‚
â”‚  - Quality 30% (ROE, GPA, CFO)                                       â”‚
â”‚  - Momentum 20% (12M-1M)                                            â”‚
â”‚                                                                      â”‚
â”‚  í†µí•©ìˆœìœ„ = ë§ˆë²•ê³µì‹ 30% + ë©€í‹°íŒ©í„° 70% â†’ TOP 30                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì¶œë ¥ ë ˆì´ì–´                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  í…”ë ˆê·¸ë¨ (1~2ê°œ ë©”ì‹œì§€, TOP20)  â”‚  AI ë¸Œë¦¬í•‘ (Gemini, ì±„ë„+ê°œì¸ë´‡)       â”‚
â”‚  í€€íŠ¸ TOP 5 ì¶”ì²œ (ë³„ë„ ë©”ì‹œì§€)  â”‚  í†µí•© CSV ì €ì¥                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. í•µì‹¬ ëª¨ë“ˆ ìƒì„¸

### 2.1 error_handler.py (~315ì¤„)

Skip & Log íŒ¨í„´ ì—ëŸ¬ ì²˜ë¦¬

#### ì—ëŸ¬ ì¹´í…Œê³ ë¦¬

```python
class ErrorCategory(Enum):
    NETWORK = "network"           # ë„¤íŠ¸ì›Œí¬/ì—°ê²° ì˜¤ë¥˜
    API_RATE_LIMIT = "rate_limit" # API í˜¸ì¶œ ì œí•œ
    DATA_NOT_FOUND = "not_found"  # ë°ì´í„° ì—†ìŒ
    PARSE_ERROR = "parse"         # íŒŒì‹± ì‹¤íŒ¨
    VALIDATION = "validation"     # ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨
    TIMEOUT = "timeout"           # íƒ€ì„ì•„ì›ƒ
    UNKNOWN = "unknown"           # ê¸°íƒ€
```

#### ErrorTracker í´ë˜ìŠ¤

```python
class ErrorTracker:
    def log_error(ticker, category, message, exception=None):
        """ì—ëŸ¬ ê¸°ë¡ + ì‹¤íŒ¨ ì¢…ëª© ì¶”ì """

    def log_warning(ticker, message):
        """ê²½ê³  ê¸°ë¡ (ë³µêµ¬ ê°€ëŠ¥)"""

    def mark_success(ticker):
        """ì„±ê³µ ì‹œ ì‹¤íŒ¨ ëª©ë¡ì—ì„œ ì œê±°"""

    def get_failed_tickers() -> List[str]:
        """ì‹¤íŒ¨ ì¢…ëª© ëª©ë¡"""

    def get_summary() -> Dict:
        """ì—ëŸ¬ í†µê³„ ìš”ì•½"""

    def save_error_log(path=None) -> Path:
        """JSON ë¡œê·¸ ì €ì¥"""
```

#### ì‚¬ìš© ì˜ˆì‹œ

```python
tracker = ErrorTracker(log_dir=Path("logs"), name="portfolio")

for ticker in tickers:
    try:
        data = get_financial_statement(ticker)
        tracker.mark_success(ticker)
    except Exception as e:
        tracker.log_error(ticker, ErrorCategory.NETWORK, "ìˆ˜ì§‘ ì‹¤íŒ¨", e)
        continue  # Skip & Log

tracker.print_summary()
tracker.save_error_log()
```

---

### 2.2 fnguide_crawler.py (~490ì¤„)

FnGuide ì¬ë¬´ì œí‘œ ìºì‹œ + ê°€ì¤‘TTM + ì»¨ì„¼ì„œìŠ¤

#### ì£¼ìš” í•¨ìˆ˜

```python
def get_financial_statement(ticker, use_cache=True):
    """ì¬ë¬´ì œí‘œ ìºì‹œ ë¡œë“œ (parquet)"""

def get_all_financial_statements(tickers, use_cache=True):
    """ì „ì²´ ì¢…ëª© ì¬ë¬´ì œí‘œ ìºì‹œ ì¼ê´„ ë¡œë“œ"""

def extract_magic_formula_data(fs_dict, base_date=None, use_ttm=True):
    """ì¬ë¬´ì œí‘œì—ì„œ ë§ˆë²•ê³µì‹/ë©€í‹°íŒ©í„° ì§€í‘œ ì¶”ì¶œ (ê°€ì¤‘TTM ì ìš©)"""

def get_consensus_data(ticker):
    """Forward EPS/PER ì»¨ì„¼ì„œìŠ¤ ìˆ˜ì§‘ (FnGuide)"""

def get_consensus_batch(tickers, delay=1.0):
    """ë°°ì¹˜ ì»¨ì„¼ì„œìŠ¤ ìˆ˜ì§‘ (ë™ê¸°)"""
```

---

### 2.3 data_collector.py (~340ì¤„)

pykrx API ë˜í¼ + ë³‘ë ¬ ì²˜ë¦¬

#### ì£¼ìš” ë©”ì„œë“œ (DataCollector í´ë˜ìŠ¤)

```python
def get_ticker_list(self, date, market='ALL'):
    """ì¢…ëª©ì½”ë“œ ëª©ë¡ ì¡°íšŒ"""

def get_market_cap(self, date, market='ALL'):
    """ì‹œê°€ì´ì•¡ ì¡°íšŒ (KOSPI/KOSDAQ)"""

def get_all_ohlcv(self, tickers, start_date=None, end_date=None):
    """OHLCV ë³‘ë ¬ ìˆ˜ì§‘ (ThreadPoolExecutor)"""

def get_market_fundamental_batch(self, date, market='ALL'):
    """pykrx PER/PBR/DIV ì¼ê´„ ì¡°íšŒ (ìºì‹œ)"""

def get_krx_sector(self, date):
    """KRX ì—…ì¢… ì •ë³´ ì¡°íšŒ"""

def get_index_ohlcv(self, start_date=None, end_date=None, ticker='1001'):
    """ì§€ìˆ˜ OHLCV ì¡°íšŒ"""
```

---

### 2.4 create_current_portfolio.py (~400ì¤„)

í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„± ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ (ë™ê¸°)

#### í•µì‹¬ í•¨ìˆ˜

```python
def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜ (ë™ê¸°)"""
    # 1. ì‹œê°€ì´ì•¡ ìˆ˜ì§‘ (pykrx)
    # 2. ìœ ë‹ˆë²„ìŠ¤ í•„í„°ë§ (ì‹œì´/ê±°ë˜ëŒ€ê¸ˆ/ê¸ˆìœµì—…)
    # 3. ì¬ë¬´ì œí‘œ ìˆ˜ì§‘ (FnGuide ìºì‹œ, ê°€ì¤‘TTM)
    # 4. pykrx ì‹¤ì‹œê°„ PER/PBR/DIV
    # 5. OHLCV ìˆ˜ì§‘ (ThreadPool ë³‘ë ¬)
    # 6. ì „ëµ A ì‚¬ì „ í•„í„° â†’ 150ì¢…ëª©
    # 7. ì „ëµ B ìŠ¤ì½”ì–´ë§ â†’ 150ì¢…ëª© ì „ì²´
    # 8. í†µí•©ìˆœìœ„ (A30% + B70%) â†’ TOP 30
    # 9. ê²°ê³¼ ì €ì¥ (CSV + ë¦¬í¬íŠ¸)

def run_strategy_a_prefilter(magic_df, universe_df, n=150):
    """ë§ˆë²•ê³µì‹ ì‚¬ì „ í•„í„°"""

def run_strategy_b_scoring(magic_df, price_df, universe_df, fund_df, prefiltered, n=30):
    """ë©€í‹°íŒ©í„° ìŠ¤ì½”ì–´ë§ (pykrx live PER/PBR/DIV ìš°ì„ )"""
```

---

### 2.5 gemini_analysis.py (~330ì¤„)

Gemini 2.5 Flash AI ë¸Œë¦¬í•‘ â€” v3 ì •ëŸ‰ ë¦¬ìŠ¤í¬ ìŠ¤ìºë„ˆ

#### ì£¼ìš” í•¨ìˆ˜

```python
def get_gemini_api_key():
    """API í‚¤ ë¡œë“œ (í™˜ê²½ë³€ìˆ˜ â†’ config.py ìˆœ)"""

def compute_risk_flags(stock):
    """ì¢…ëª©ë³„ 6ê°€ì§€ ìœ„í—˜ í”Œë˜ê·¸ ê³„ì‚° (ì½”ë“œ íŒ©íŠ¸ ê¸°ë°˜)"""
    # ğŸ”º ê³¼ë§¤ìˆ˜(RSIâ‰¥75), ğŸ“‰ 52ì£¼ê¸‰ë½(â‰¤-35%), âš ï¸ ì „ì¼ê¸‰ë½(â‰¤-5%)
    # ğŸ”º ì „ì¼ê¸‰ë“±(â‰¥+8%), ğŸ’° ê³ í‰ê°€(PER>40), ğŸ“Š ê±°ë˜ëŸ‰í­ë°œ(â‰¥3ë°°)

def build_prompt(stock_list):
    """v3 í”„ë¡¬í”„íŠ¸ â€” ì¢…ëª©ë³„ ì¸ë¼ì¸ í”Œë˜ê·¸ + ìœ„í—˜ ì‹ í˜¸ ì„¤ëª…"""
    # [ì¢…ëª©ë³„ ë°ì´í„° & ìœ„í—˜ ì‹ í˜¸] + [ìœ„í—˜ ì‹ í˜¸ ì„¤ëª…] + [ì¶œë ¥ í˜•ì‹]

def convert_markdown_to_html(text):
    """Gemini ë§ˆí¬ë‹¤ìš´ â†’ í…”ë ˆê·¸ë¨ HTML (**â†’<b>, [SEP]â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€)"""

def extract_text(resp):
    """response.text Noneì¼ ë•Œ partsì—ì„œ ì§ì ‘ ì¶”ì¶œ"""

def run_ai_analysis(portfolio_message, stock_list):
    """Gemini API í˜¸ì¶œ â†’ HTML ë¸Œë¦¬í•‘ ë°˜í™˜ (âœ… í´ë¦° ë¦¬ìŠ¤íŠ¸ ì½”ë“œ ìƒì„±)"""
    # ë¹ˆ ì‘ë‹µ ë°©ì–´: finish_reason ë¡œê·¸ + 1íšŒ ì¬ì‹œë„
    # temperature=0.3 (0.2=ë¹ˆì‘ë‹µ, 0.5=í• ë£¨ì‹œë„¤ì´ì…˜)
```

#### AI ë¸Œë¦¬í•‘ ì¶œë ¥ êµ¬ì¡°
- ğŸ“° ì´ë²ˆ ì£¼ ì‹œì¥: Google Search 1íšŒ (ì‹œì¥ ì „ë°˜ ì´ë²¤íŠ¸)
- âš ï¸ ì£¼ì˜ ì¢…ëª©: ì½”ë“œ ê°ì§€ ì‹ í˜¸ í•´ì„ (ì—†ìœ¼ë©´ ìƒëµ)
- ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ íŠ¹ì§•: ì„¹í„° í¸ì¤‘, ë°¸ë¥˜ì—ì´ì…˜, ëª¨ë©˜í…€ íŒ¨í„´

#### ì—°ë™ íë¦„
```
send_telegram_auto.py â†’ run_ai_analysis(None, stock_list)
  â†’ build_prompt(stock_list)  # ì½”ë“œê°€ ë°ì´í„°+ì£¼ì˜ì‹ í˜¸ êµ¬ì„±
  â†’ genai.Client â†’ Gemini 2.5 Flash (temperature=0.3)
  â†’ Google Search Grounding (ì‹œì¥ ë™í–¥ 1íšŒë§Œ)
  â†’ ë§ˆí¬ë‹¤ìš´â†’í…ìŠ¤íŠ¸ ë³€í™˜ â†’ ì±„ë„+ê°œì¸ë´‡ ì „ì†¡
```

---

## 3. ë°ì´í„° íë¦„

### í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„± (create_current_portfolio.py)

```
1. pykrxì—ì„œ ì‹œê°€ì´ì•¡ ì¡°íšŒ
   â””â”€ KOSPI + KOSDAQ = ~2,773ê°œ

2. ìœ ë‹ˆë²„ìŠ¤ í•„í„°ë§
   â”œâ”€ ì‹œê°€ì´ì•¡ >= 3000ì–µì›
   â”œâ”€ ê±°ë˜ëŒ€ê¸ˆ >= 50ì–µì› (20ì¼ í‰ê· )
   â””â”€ ê¸ˆìœµ/ì§€ì£¼ ì œì™¸ â†’ ~450ê°œ

3. ì¬ë¬´ì œí‘œ ìˆ˜ì§‘
   â””â”€ FnGuide ìºì‹œ ë¡œë“œ (parquet)

3.5. pykrx ì‹¤ì‹œê°„ í€ë”ë©˜í„¸ (PER/PBR/DIV)
   â””â”€ get_market_fundamental_batch(BASE_DATE)

4. ê°€ì¤‘TTM ê³„ì‚°
   â”œâ”€ Flow: ìµœê·¼ 4ë¶„ê¸° ê°€ì¤‘ í•©ì‚° (40/30/20/10%)
   â””â”€ Stock: ìµœê·¼ ë¶„ê¸° ê°’

5. ì „ëµ A ì‚¬ì „ í•„í„° â†’ 150ì¢…ëª©
   â””â”€ ì´ìµìˆ˜ìµë¥  + ROC ìˆœìœ„ í•©ì‚°

3.6. PER/PBR ìƒí•œ í•„í„° (PER>60, PBR>10 ì œì™¸)
   â””â”€ ê³ í‰ê°€ ì¡ì£¼ ì œê±° â†’ ~290ê°œ

6. ì „ëµ B ìŠ¤ì½”ì–´ë§ â†’ 150ì¢…ëª© ì „ì²´
   â””â”€ Value*0.5 + Quality*0.3 + Momentum*0.2
   â””â”€ PER/PBR/DIV: pykrx ì‹¤ì‹œê°„ ìš°ì„ 

7. í†µí•©ìˆœìœ„ â†’ TOP 30
   â””â”€ ë§ˆë²•ê³µì‹ 30% + ë©€í‹°íŒ©í„° 70%

8. ê²°ê³¼ ì €ì¥
   â””â”€ output/portfolio_YYYY_MM.csv (í†µí•©)
```

---

## 4. íŒŒì¼ êµ¬ì¡°

```
quant_py-main/
â”œâ”€â”€ í•µì‹¬ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ error_handler.py          # Skip & Log ì—ëŸ¬ ì²˜ë¦¬
â”‚   â”œâ”€â”€ fnguide_crawler.py        # FnGuide ì¬ë¬´ì œí‘œ ìºì‹œ + ê°€ì¤‘TTM
â”‚   â”œâ”€â”€ data_collector.py         # pykrx API + ë³‘ë ¬ ì²˜ë¦¬ + í€ë”ë©˜í„¸ ë°°ì¹˜
â”‚   â”œâ”€â”€ strategy_a_magic.py       # ì „ëµ A: ë§ˆë²•ê³µì‹ (ì‚¬ì „ í•„í„°)
â”‚   â”œâ”€â”€ strategy_b_multifactor.py # ì „ëµ B: ë©€í‹°íŒ©í„° (pykrx live ìš°ì„ )
â”‚   â””â”€â”€ gemini_analysis.py         # Gemini AI ë¸Œë¦¬í•‘ ("ê²€ìƒ‰ì€ ì½”ë“œê°€, ë¶„ì„ì€ AIê°€")
â”‚
â”œâ”€â”€ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ create_current_portfolio.py  # í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„± (Aâ†’í•„í„°, Bâ†’ìŠ¤ì½”ì–´, í†µí•©ìˆœìœ„)
â”‚   â”œâ”€â”€ send_telegram_auto.py        # í…”ë ˆê·¸ë¨ ìë™ ì „ì†¡ (TOP20, AI ë¸Œë¦¬í•‘, TOP5 ì¶”ì²œ)
â”‚   â”œâ”€â”€ full_backtest.py             # ì „ì²´ ë°±í…ŒìŠ¤íŒ…
â”‚   â””â”€â”€ generate_report_pdf.py       # PDF ë¦¬í¬íŠ¸ ìƒì„±
â”‚
â”œâ”€â”€ ì„¤ì •
â”‚   â”œâ”€â”€ config.py                    # APIí‚¤/í…”ë ˆê·¸ë¨ (gitignore)
â”‚   â””â”€â”€ config_template.py           # ì„¤ì • í…œí”Œë¦¿
â”‚
â”œâ”€â”€ ì¶œë ¥
â”‚   â”œâ”€â”€ output/                      # portfolio_YYYY_MM.csv (í†µí•©)
â”‚   â””â”€â”€ backtest_results/            # ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼
â”‚
â”œâ”€â”€ ìºì‹œ
â”‚   â””â”€â”€ data_cache/
â”‚       â”œâ”€â”€ fs_fnguide_{ticker}.parquet      # ì¬ë¬´ì œí‘œ (git ì¶”ì )
â”‚       â”œâ”€â”€ fundamental_batch_*.parquet      # pykrx í€ë”ë©˜í„¸ (gitignore)
â”‚       â”œâ”€â”€ all_ohlcv_{start}_{end}.parquet  # OHLCV (gitignore)
â”‚       â””â”€â”€ market_cap_ALL_{date}.parquet    # ì‹œê°€ì´ì•¡ (gitignore)
â”‚
â””â”€â”€ ë¬¸ì„œ
    â”œâ”€â”€ README.md
    â””â”€â”€ SESSION_HANDOFF.md (ì´ íŒŒì¼)
```

---

## 5. ì•Œë ¤ì§„ ì œí•œì‚¬í•­

### ë°ì´í„° ê´€ë ¨
1. **FnGuide ì»¨ì„¼ì„œìŠ¤**: ëŒ€í˜•ì£¼ ìœ„ì£¼ ì»¤ë²„ë¦¬ì§€ (~60%)
3. **ì„ í˜¸ì£¼/ìš°ì„ ì£¼**: ì¼ë¶€ ì¬ë¬´ì œí‘œ ëˆ„ë½ ê°€ëŠ¥

### ì „ëµ ê´€ë ¨
1. **ì„¹í„° ë¶„ë¥˜ ì—†ìŒ**: ì—…ì¢… ì¤‘ë¦½í™” ë¯¸ì ìš©
2. **ê±°ë˜ë¹„ìš©**: 0.3% ê³ ì • (ìŠ¬ë¦¬í”¼ì§€ ë¯¸ë°˜ì˜)

### ë°±í…ŒìŠ¤íŒ… ê´€ë ¨
1. **ìƒì¡´ í¸í–¥**: ìƒì¥íì§€ ì¢…ëª© ë¯¸í¬í•¨
2. **Look-ahead bias**: ì¬ë¬´ì œí‘œ ê³µì‹œ ì‹œì°¨ ë°˜ì˜ (45ì¼/90ì¼)
3. **ë°°ë‹¹ ë¯¸ë°˜ì˜**: ë°°ë‹¹ ì¬íˆ¬ì ë¯¸êµ¬í˜„

---

## 6. ì‘ì—… ë¡œê·¸

| ë‚ ì§œ | ì£¼ìš” ì‘ì—… | íŒŒì¼ |
|------|-----------|------|
| 2026-01-30 | í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„± ì‹œìŠ¤í…œ êµ¬í˜„ | create_current_portfolio.py |
| 2026-01-31 | ì¼ë³„ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬í˜„ | daily_monitor.py |
| 2026-02-01 | í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ 3ë¶„í•  | daily_monitor.py |
| 2026-02-02 | ëª¨ë©˜í…€ íŒ©í„° êµ¬í˜„ | strategy_b_multifactor.py |
| 2026-02-03 | v6.4 ë¦¬íŒ©í† ë§ (Quality+Price 2ì¶•) | daily_monitor.py |
| **2026-02-03** | **Skip & Log ì—ëŸ¬ ì²˜ë¦¬ ë„ì…** | **error_handler.py (NEW)** |
| **2026-02-03** | **Skip & Log ì—ëŸ¬ ì²˜ë¦¬** | **error_handler.py (NEW)** |
| **2026-02-03** | **ë³‘ë ¬ ì²˜ë¦¬ ì¶”ê°€** | **data_collector.py** |
| **2026-02-03** | **main() êµ¬ì¡° ì „í™˜ (ë™ê¸°)** | **create_current_portfolio.py** |
| **2026-02-03** | **ê±°ë˜ëŒ€ê¸ˆ í•„í„° 30ì–µìœ¼ë¡œ ì¡°ì •** | **config.py** |
| **2026-02-03** | **ë¬¸ì„œ ì „ë©´ ì—…ë°ì´íŠ¸** | **README.md** |
| **2026-02-04** | **20ì¼ í‰ê·  ê±°ë˜ëŒ€ê¸ˆ í•„í„° ì ìš©** | **create_current_portfolio.py** |
| **2026-02-05** | **í…”ë ˆê·¸ë¨ ì™„ì „ ìë™í™” (send_telegram_auto.py)** | **send_telegram_auto.py (NEW)** |
| **2026-02-05** | **ë¶„ì„ ê¸°ì¤€ì¼ ì „ì¼ ê±°ë˜ì¼ë¡œ ë³€ê²½** | **send_telegram_auto.py** |
| **2026-02-05** | **ì§„ì…ì ìˆ˜ ê°œì„ : ì‹ ê³ ê°€ ë³´ë„ˆìŠ¤ ì œê±° (ì‹¸ê²Œ ì‚¬ì ì² í•™)** | **send_telegram_auto.py** |
| **2026-02-05** | **í•µì‹¬ì¶”ì²œ ì„¹ì…˜ ì œê±° (ìˆœìœ„ë§Œ í‘œì‹œ)** | **send_telegram_auto.py** |
| **2026-02-05** | **ë‰´ìŠ¤ ìë™ í¬ë¡¤ë§ ë° ì„¼í‹°ë¨¼íŠ¸ ë¶„ì„ ì¶”ê°€** | **send_telegram_auto.py** |
| **2026-02-05** | **ë‰´ìŠ¤ í—¤ë“œë¼ì¸ ìš”ì•½ ê°œì„  (ì‹œì„¸ë‰´ìŠ¤ í•„í„°ë§)** | **send_telegram_auto.py** |
| **2026-02-05** | **GitHub Actions ìë™í™” (ë§¤ì¼ 06:00 KST)** | **.github/workflows/telegram_daily.yml (NEW)** |
| **2026-02-05** | **í…”ë ˆê·¸ë¨ ê³µê°œì±„ë„ ì—°ë™ (kr_dailyquant)** | **config.py, send_telegram_auto.py** |
| **2026-02-05** | **ì±„ë„/ë´‡ ì´ì¤‘ ì „ì†¡ ë¡œì§ êµ¬í˜„** | **send_telegram_auto.py** |
| **2026-02-05** | **OHLCV ìºì‹œ ê²€ì¦ ë¡œì§ ì¶”ê°€ (BASE_DATE í™•ì¸)** | **create_current_portfolio.py** |
| **2026-02-05** | **CSV íŒŒì¼ ì»¤ë°‹ í•„ìˆ˜ ë¬¸ì„œí™”** | **SESSION_HANDOFF.md** |
| **2026-02-06** | **KST íƒ€ì„ì¡´ ëª…ì‹œì  ì²˜ë¦¬ ì¶”ê°€** | **create_current_portfolio.py, send_telegram_auto.py** |
| **2026-02-06** | **GitHub Actionsì— í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„± ë‹¨ê³„ ì¶”ê°€** | **.github/workflows/telegram_daily.yml** |
| **2026-02-06** | **GitHub Actions ì˜ì¡´ì„± ì¶”ê°€ (tqdm, scipy)** | **.github/workflows/telegram_daily.yml** |
| **2026-02-06** | **error_handler.py ëˆ„ë½ íŒŒì¼ ì»¤ë°‹** | **error_handler.py** |
| **2026-02-06** | **ë¦¬ë°¸ëŸ°ì‹± ê¶Œì¥ ì›” ìˆ˜ì • (4/5/8/11ì›”)** | **send_telegram_auto.py** |
| **2026-02-07** | **Git ìºì‹œ ì •ë¦¬ (2,261ê°œ ì œê±°, fs_fnguide 743ê°œ ìœ ì§€)** | **.gitignore** |
| **2026-02-07** | **DART API ì™„ì „ ì œê±° (dart_api.py ì‚­ì œ)** | **dart_api.py, config.py, README.md** |
| **2026-02-07** | **ë°ì´í„° ìµœì‹ ì„± ë¬¸ì œ ë¶„ì„ (Strategy A 75%, B 85% ì •ì )** | **ë¶„ì„ ê²°ê³¼ ë¬¸ì„œí™”** |
| **2026-02-07** | **v3.1: Aâ†’í•„í„°(150), Bâ†’ìŠ¤ì½”ì–´ë§, A30%+B70% í†µí•©ìˆœìœ„** | **create_current_portfolio.py** |
| **2026-02-07** | **pykrx ì‹¤ì‹œê°„ PER/PBR/DIV ìš°ì„  ì‚¬ìš©** | **strategy_b_multifactor.py, data_collector.py** |
| **2026-02-07** | **ê°€ì¤‘TTM ì ìš© (40/30/20/10%)** | **fnguide_crawler.py** |
| **2026-02-07** | **TOP20 ìƒì„¸ + ë‰´ìŠ¤ í•„í„°ë§ + SECTOR_DB í™•ì¥** | **send_telegram_auto.py** |
| **2026-02-07** | **ê³µë™ìˆœìœ„ ì œê±° (method='first')** | **strategy_a/b, create_current_portfolio.py** |
| **2026-02-07** | **msg2(ì „ì²´30ê°„ëµ) ì‚­ì œ â†’ 1~2ê°œ ë©”ì‹œì§€ë§Œ** | **send_telegram_auto.py** |
| **2026-02-08** | **EBIT ìˆ˜ì •: EBTâ†’ì˜ì—…ì´ìµ ì‚¬ìš©** | **strategy_a_magic.py** |
| **2026-02-08** | **IC ìˆ˜ì •: ë¹„ìœ ë™ìì‚°ë§Œ (ì´ë¯¸ ìˆœì•¡)** | **strategy_a_magic.py** |
| **2026-02-08** | **ê°€ì¤‘TTM ì •ê·œí™”: <4ë¶„ê¸°ì‹œ weights scale** | **fnguide_crawler.py** |
| **2026-02-08** | **Z-Score: Winsorizing(1%/99%), std=0 ê°€ë“œ** | **strategy_b_multifactor.py** |
| **2026-02-08** | **async/await ì™„ì „ ì œê±° (ë™ê¸°í™”)** | **create_current_portfolio.py** |
| **2026-02-08** | **ëª¨ë“ˆ êµ¬ì¡°í™”: main() í•¨ìˆ˜í™”** | **send_telegram_auto.py** |
| **2026-02-08** | **bare except â†’ except Exception: í†µì¼** | **ì „ì²´ íŒŒì¼** |
| **2026-02-08** | **ë¶ˆí•„ìš” íŒŒì¼ ì‚­ì œ (utils.py, backtest_main.py ë“± 7ê°œ)** | **í”„ë¡œì íŠ¸ ì •ë¦¬** |
| **2026-02-08** | **dead code ì œê±° (async decorator, prepare_data í•¨ìˆ˜)** | **error_handler.py, strategy_a_magic.py** |
| **2026-02-08** | **ë¬¸ì„œ í˜„í–‰í™” (README.md, SESSION_HANDOFF.md)** | **MD íŒŒì¼** |
| **2026-02-08** | **Gemini AI ë¦¬ìŠ¤í¬ ìŠ¤ìºë„ˆ êµ¬í˜„ (Google Search Grounding)** | **gemini_analysis.py (NEW)** |
| **2026-02-08** | **send_telegram_autoì— AI ë¶„ì„ í†µí•© (í¬íŠ¸í´ë¦¬ì˜¤â†’Geminiâ†’ì „ì†¡)** | **send_telegram_auto.py** |
| **2026-02-08** | **GitHub Actionsì— Gemini ì—°ë™ (secret + google-genai)** | **telegram_daily.yml, config_template.py** |
| **2026-02-08** | **ì¢…ëª©ë³„ ë‰´ìŠ¤ í¬ë¡¤ë§ ì œê±° (RSS 30íšŒ â†’ 0, ë¶€ë¶„ë§¤ì¹­ ë¬¸ì œ í•´ê²°)** | **send_telegram_auto.py** |
| **2026-02-08** | **AI ë¦¬ìŠ¤í¬ ìŠ¤ìºë„ˆ â†’ AI ë¸Œë¦¬í•‘ ì „í™˜ ("ê²€ìƒ‰ì€ ì½”ë“œê°€, ë¶„ì„ì€ AIê°€")** | **gemini_analysis.py** |
| **2026-02-08** | **AI ë¸Œë¦¬í•‘ ê°œì¸ë´‡ì—ë§Œ ì „ì†¡ (ì±„ë„ ì œì™¸)** | **send_telegram_auto.py** |
| **2026-02-09** | **v3.2: ìœ ë‹ˆë²„ìŠ¤ ê°•í™” (ì‹œì´3000ì–µ, ê±°ë˜50ì–µ, PERâ‰¤60, PBRâ‰¤10)** | **create_current_portfolio.py** |
| **2026-02-09** | **ë©€í‹°íŒ©í„° ë¹„ì¤‘ ì¡°ì • (Value50/Quality30/Momentum20)** | **strategy_b_multifactor.py** |
| **2026-02-09** | **AI ë¸Œë¦¬í•‘ ì±„ë„+ê°œì¸ë´‡ ì „ì†¡ ë³µì›** | **send_telegram_auto.py** |
| **2026-02-09** | **SECTOR_DB 19ì¢…ëª© ì¶”ê°€ (ê¸°íƒ€â†’êµ¬ì²´ì  ì—…ì¢…ëª…)** | **send_telegram_auto.py** |
| **2026-02-09** | **AI ë¸Œë¦¬í•‘ v3: 6ê°€ì§€ ì •ëŸ‰ ë¦¬ìŠ¤í¬ í”Œë˜ê·¸ + Telegram HTML** | **gemini_analysis.py** |
| **2026-02-09** | **AI ë¸Œë¦¬í•‘ parse_mode='HTML' + [SEP] ë¶„ë¦¬ì„ ** | **send_telegram_auto.py** |
| **2026-02-09** | **TOP20 ì¢…ëª©ê°„ ë¹ˆ ì¤„ ì œê±° (ì—¬ë°± ì¶•ì†Œ)** | **send_telegram_auto.py** |
| **2026-02-09** | **í€€íŠ¸ TOP 5 ìë™ ì¶”ì²œ (ìœ„í—˜ í”Œë˜ê·¸ ì œì™¸ + ì„¹í„° ë¶„ì‚°)** | **send_telegram_auto.py** |

---

**ë¬¸ì„œ ë²„ì „**: 10.4
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-02-09
