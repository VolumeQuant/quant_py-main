# 한국 주식 퀀트 포트폴리오 시스템 - 프로젝트 리포트

**버전**: 3.0
**기준일**: 2026-02-03
**최종 업데이트**: 2026-02-03

---

## 1. 프로젝트 개요

한국 주식 시장(KOSPI/KOSDAQ)을 대상으로 퀀트 전략을 백테스팅하고, 실제 투자 가능한 포트폴리오를 생성하며, 일별 진입 타이밍을 분석하는 통합 시스템입니다.

### 핵심 기능

| 기능 | 설명 | 실행 시간 |
|------|------|-----------|
| 포트폴리오 생성 | 전략 A/B로 분기별 종목 선정 | **~15초 (캐시)** / ~5분 (DART) |
| 백테스팅 | 2015-2025 11년 전략 검증 | ~15분 |
| 일별 모니터링 | 진입 타이밍 자동 분석 + Forward EPS | ~3분 |
| 텔레그램 알림 | 매수 적기 종목 실시간 알림 | 자동 |

### v3.0 주요 변경사항 (2026-02-03)

| 항목 | 변경 전 | 변경 후 |
|------|--------|---------|
| **재무제표 소스** | FnGuide 크롤링 (~50분) | OpenDART API (~2분) |
| **처리 방식** | 순차 처리 | 비동기 + 병렬 처리 |
| **에러 처리** | print + 무시 | Skip & Log 패턴 |
| **거래대금 필터** | 10억원 | **30억원** |
| **총 소요시간** | ~50분 | **~15초 (캐시)** |

---

## 2. 전략 상세

### 전략 A: 마법공식 (Magic Formula)

**기반**: Joel Greenblatt의 『주식시장을 이기는 작은 책』

**팩터 구성**:
```
이익수익률 (Earnings Yield) = EBIT / EV
투하자본수익률 (ROC) = EBIT / Invested Capital

마법공식 순위 = rank(이익수익률) + rank(ROC)
```

**특징**:
- 저평가 + 고효율 기업 발굴
- 중소형주 중심 (코스닥 비중 ~80%)
- 보수적 MDD (-24.42%)

---

### 전략 B: 멀티팩터 (Multi-Factor)

**팩터 구성**:
```
밸류 (40%): PER, PBR, PCR, PSR → -Z-Score (낮을수록 좋음)
퀄리티 (40%): ROE, GPA, CFO/Assets → Z-Score (높을수록 좋음)
모멘텀 (20%): 12개월 수익률 (최근 1개월 제외)

멀티팩터 점수 = Value*0.4 + Quality*0.4 + Momentum*0.2
```

**특징**:
- 학술적 팩터 결합 (Fama-French + Carhart)
- 모멘텀 데이터 없는 종목 자동 제외
- 공격적 수익률 (CAGR 13.15%)

---

## 3. 백테스팅 결과 (2015-2025)

### 성과 지표 비교

| 지표 | KOSPI | 전략 A | 전략 B |
|------|-------|--------|--------|
| **총 수익률** | - | **90.77%** | **102.36%** |
| **CAGR** | 7.58% | **11.98%** | **13.15%** |
| **MDD** | -43.90% | **-24.42%** | -33.90% |
| **Sharpe** | 0.27 | **0.53** | **0.53** |
| **Sortino** | - | 0.78 | 0.80 |
| **Win Rate** | - | 52.64% | 52.36% |

### In-Sample vs Out-of-Sample

| 구간 | 기간 | 전략 A CAGR | 전략 B CAGR |
|------|------|-------------|-------------|
| **In-Sample** | 2015-2023 | 3.01% | 7.06% |
| **Out-of-Sample** | 2024-2025 | **67.50%** | **47.71%** |

**결론**: OOS에서 더 좋은 성과 → 과적합 우려 낮음

---

## 4. 현재 포트폴리오 (2026년 2월)

### 유니버스 현황

| 단계 | 종목 수 |
|------|--------|
| 전체 (KOSPI+KOSDAQ) | 2,774개 |
| 시총 1000억+ | 1,100개 |
| 거래대금 30억+ | 824개 |
| 금융/지주 제외 후 | **777개** |

### 전략 A TOP 10 (마법공식)

| 순위 | 종목코드 | 종목명 | 시장 |
|------|----------|--------|------|
| 1 | 018290 | 브이티 | 코스닥 |
| 2 | 123330 | 원풍 | 코스닥 |
| 3 | 340570 | 티앤엘 | 코스닥 |
| 4 | 033100 | 제룡전기 | 코스닥 |
| 5 | 200670 | 휴메딕스 | 코스닥 |
| 6 | 383220 | F&F | 코스피 |
| 7 | 067160 | SOOP | 코스닥 |
| 8 | 035900 | JYP Ent. | 코스피 |
| 9 | 462870 | 시프트업 | 코스닥 |
| 10 | 402340 | SK스퀘어 | 코스피 |

### 전략 B TOP 10 (멀티팩터)

| 순위 | 종목코드 | 종목명 | 시장 |
|------|----------|--------|------|
| 1 | 278470 | 케이씨피아이 | 코스닥 |
| 2 | 084670 | 동양피스톤 | 코스닥 |
| 3 | 036620 | 감성코퍼레이션 | 코스닥 |
| 4 | 000660 | SK하이닉스 | 코스피 |
| 5 | 108490 | 로보티즈 | 코스닥 |
| 6 | 489790 | 한화비전 | 코스피 |
| 7 | 124500 | 에이티세미콘 | 코스닥 |
| 8 | 204620 | 글로벌텍스프리 | 코스닥 |
| 9 | 043260 | 성호전자 | 코스닥 |
| 10 | 194480 | 데브시스터즈 | 코스닥 |

### 공통 종목 (8개)

양쪽 전략에서 모두 선정된 **강력 추천** 종목:

| 종목코드 | 종목명 |
|----------|--------|
| 124500 | 에이티세미콘 |
| 018290 | 브이티 |
| 000660 | SK하이닉스 |
| 204620 | 글로벌텍스프리 |
| 033100 | 제룡전기 |
| 033500 | 삼화전자 |
| 119850 | 한국사료 |
| 067160 | SOOP |

---

## 5. 시스템 아키텍처 (v3.0)

### 데이터 수집 레이어

```
┌─────────────────────────────────────────────────────────────────┐
│                        데이터 소스                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  pykrx API              OpenDART API           FnGuide          │
│  ┌─────────────┐       ┌─────────────┐      ┌─────────────┐    │
│  │ 시가총액    │       │ 재무제표    │      │ 컨센서스    │    │
│  │ OHLCV      │       │ (연간/분기) │      │ Forward EPS │    │
│  │ (병렬수집)  │       │ (비동기)    │      │ Forward PER │    │
│  └─────────────┘       └─────────────┘      └─────────────┘    │
│         │                    │                    │             │
│         │    ThreadPool      │    aiohttp         │  requests   │
│         │                    │                    │             │
└─────────┴────────────────────┴────────────────────┴─────────────┘
```

### 에러 처리 (Skip & Log)

```python
# 기존 방식
try:
    data = fetch(ticker)
except:
    print(f"에러: {ticker}")  # 크래시 또는 무시

# 새로운 방식 (Skip & Log)
try:
    data = fetch(ticker)
    tracker.mark_success(ticker)
except Exception as e:
    tracker.log_error(ticker, ErrorCategory.NETWORK, "수집 실패", e)
    continue  # 다음 종목으로 계속

# 최종 요약
tracker.print_summary()  # 에러 통계
tracker.save_error_log() # JSON 로그 저장
```

---

## 6. 성능 최적화

### 리팩토링 전후 비교

| 단계 | Before | After | 개선 |
|------|--------|-------|------|
| 시가총액 | 30초 | 30초 | - |
| 종목명 수집 | 2분 | 30초 | **4x** |
| 재무제표 | 50분 | 2분 | **25x** |
| OHLCV | 4분 | 1분 | **4x** |
| **합계** | **~57분** | **~4분** | **14x** |
| **캐시 모드** | - | **15초** | - |

### 최적화 기법

1. **OpenDART API**
   - FnGuide 크롤링 대체
   - 공식 API로 안정성 확보
   - 일일 10,000건 무료

2. **비동기 처리 (asyncio + aiohttp)**
   - DART API 동시 요청
   - Semaphore로 동시성 제어

3. **병렬 처리 (ThreadPoolExecutor)**
   - OHLCV 수집
   - 종목명 수집
   - max_workers=10

4. **Parquet 캐시**
   - 재무제표: `fs_fnguide_{ticker}.parquet`
   - OHLCV: `all_ohlcv_{start}_{end}.parquet`
   - 시가총액: `market_cap_ALL_{date}.parquet`

---

## 7. 일별 모니터링 v6.4

### Quality(맛) + Price(값) 2축 시스템

**Quality Score (펀더멘털 매력도)**

| 항목 | 가중치 | 설명 |
|------|--------|------|
| 전략등급 | 25% | A+B > A or B |
| PER | 25% | 낮을수록 고득점 |
| ROE | 20% | 높을수록 고득점 |
| 회복여력 | 15% | 52주 고점 대비 낙폭 |
| MA정배열 | 15% | 5>20>60>120일선 |

**Price Score (진입 타이밍)**

| 항목 | 가중치 | 설명 |
|------|--------|------|
| RSI | 30% | 30-45=100점, 70-80=85점(좋은과열) |
| 볼린저 | 20% | 하단=100점, 상단+거래량=75점 |
| 거래량 | 20% | 3배=100점, 2배=85점 |
| 이격도 | 15% | -20%=100점, +30%=0점 |
| 52주위치 | 15% | 저점=100점, 신고가+거래량=90점 |

### 4분류 시스템

| 분류 | 이모지 | 조건 | 행동 |
|------|--------|------|------|
| STRONG_MOMENTUM | 🚀 | 신고가+거래량+RSI70-80 | 추세매수 |
| DIP_BUYING | 🛡️ | 급락+지지선+RSI<50 | 저점매수 |
| WAIT_OBSERVE | 🟡 | 양호/타이밍대기 | 관망 |
| NO_ENTRY | 🚫 | 버블/과열/저품질 | 금지 |

---

## 8. 텔레그램 알림

### 메시지 구조 (3개)

**메시지 1: 포트폴리오 개요**
```
📊 퀀트 포트폴리오 (리팩토링)
━━━━━━━━━━━━━━━━━━━━━━━━━

🔴 전략 A - 마법공식 (30개)
이익수익률 + 투하자본수익률

• 브이티 (018290)
• 원풍 (123330)
...
```

**메시지 2: 전략 B 종목**
```
🔵 전략 B - 멀티팩터 (30개)
밸류 40% + 퀄리티 40% + 모멘텀 20%

• 케이씨피아이 (278470)
• 동양피스톤 (084670)
...
```

**메시지 3: 공통 종목**
```
⭐ 공통 종목 (8개)
두 전략 모두 선정 = 강력 추천

• 에이티세미콘 (124500)
• 브이티 (018290)
• SK하이닉스 (000660)
...
```

---

## 9. 기술 스택

### 핵심 라이브러리

| 패키지 | 버전 | 용도 |
|--------|------|------|
| pykrx | 1.2.3 | 한국 주식 데이터 API |
| aiohttp | 3.11+ | 비동기 HTTP (DART API) |
| pandas | 2.2+ | 데이터 처리 |
| numpy | 2.1+ | 수치 계산 |
| requests | 2.32+ | 동기 HTTP |
| beautifulsoup4 | 4.12+ | FnGuide 크롤링 |
| pyarrow | - | Parquet 캐시 |

### 데이터 소스

| 소스 | 제공 데이터 | 방식 |
|------|------------|------|
| pykrx (KRX) | 시가총액, OHLCV | 병렬 처리 |
| OpenDART | 재무제표 (연간/분기) | 비동기 API |
| FnGuide | 컨센서스 (Forward EPS) | 웹 크롤링 |

---

## 10. 결론 및 투자 전략

### 전략별 특성

| 특성 | 전략 A (마법공식) | 전략 B (멀티팩터) |
|------|------------------|------------------|
| 성향 | 보수적 | 공격적 |
| MDD | -24.42% | -33.90% |
| 코스닥 비중 | 80% | 83% |
| 적합 투자자 | 안정 추구 | 고수익 추구 |

### 권장 투자 비중

- **보수적 투자자**: 전략 A 70% + 전략 B 30%
- **공격적 투자자**: 전략 A 30% + 전략 B 70%
- **공통 종목 집중**: 8개 공통 종목에 50% 이상 배분

### 리밸런싱 주기

- **분기별 리밸런싱** (3월, 6월, 9월, 12월 말)
- 재무제표 공시 후 45일 대기
- 거래비용 0.3% 가정

---

**생성일**: 2026-02-03
**작성**: Claude Opus 4.5
