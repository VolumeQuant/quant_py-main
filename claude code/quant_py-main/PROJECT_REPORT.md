# 한국 주식 멀티팩터 백테스팅 시스템 - 프로젝트 리포트

## 프로젝트 개요

한국 주식 시장(KOSPI/KOSDAQ)을 대상으로 퀀트 전략을 백테스팅하고, 실제 투자 가능한 현재 포트폴리오를 생성하는 시스템입니다.

### 전략 설명

#### 전략 A: 마법공식 (Magic Formula) ⭐ 채택
- **기반**: Joel Greenblatt의 "주식시장을 이기는 작은 책"
- **팩터**:
  - 이익수익률 (Earnings Yield): EBIT / EV
  - 투하자본수익률 (ROIC): EBIT / Invested Capital
- **선정 방식**: 두 팩터 순위 합산 → 상위 30종목 선정
- **특징**: 중소형주 중심 (코스닥 60%), 분기별 리밸런싱

#### 전략 B: 멀티팩터 (Multi-Factor) ⭐ 채택
- **팩터 구성**:
  - Value (40%): PER, PBR, PCR, PSR
  - Quality (40%): ROE, GPA, CFO/Assets
  - Momentum (20%): 6개월/12개월 수익률
- **선정 방식**: 팩터별 Z-score → 가중평균 → 상위 30종목 선정
- **특징**: 대형주 중심 (메가캡 KOSPI 100%), 분기별 리밸런싱

#### 전략 C: 코스닥 성장 (KOSDAQ Growth) ❌ 폐기
- **의도**: 정부 코스닥 3000 정책에 특화된 전략
- **팩터**: Growth (50%) + Momentum (30%) + Quality (20%)
- **백테스팅 결과**: CAGR -5.33%, MDD -69.85% (참혹한 실패)
- **폐기 사유**: 성장률 데이터 부정확, 모멘텀 과열, 코스닥 고변동성
- **교훈**: 정부 정책보다 펀더멘털이 중요

---

## 실행 결과

### 1. 현재 포트폴리오 (2026년 1월)

**기준일**: 2026-01-29
**유니버스**: 2,773개 → 1,101개 (필터링 후)

#### 시장 구성 비율
- **전략 A**: 코스닥 18개 (60%) + 코스피 12개 (40%)
- **전략 B**: 코스피 30개 (100%, 메가캡)

**전략 A 코스닥 종목 (18개)**:
브이티, 티앤엘, 제룡전기, 월덱스, SOOP, 알트, GST, 디케이티, 휴메딕스, 피엔티, 하이비젼시스템, 모비스, 엘앤씨바이오, 지엔씨에너지, AP시스템, 한양이엔지, 한솔아이원스, 슈프리마

#### 필터 조건
- 시가총액 >= 1,000억원
- 거래대금 >= 10억원 (일평균)
- 금융업/지주사 제외

#### 전략 A 상위 10종목
| 순위 | 종목코드 | 종목명 | 이익수익률 | 투하자본수익률 |
|------|----------|--------|------------|----------------|
| 1 | 018290 | 브이티 | 17.49% | 53.41% |
| 2 | 101160 | 월덱스 | 25.44% | 28.46% |
| 3 | 340570 | 티앤엘 | 15.97% | 36.76% |
| 4 | 071200 | 인피니트헬스케어 | 24.85% | 27.45% |
| 5 | 033100 | 제룡전기 | 13.96% | 52.32% |
| 6 | 187790 | 나노 | 13.26% | 62.84% |
| 7 | 051360 | 토비스 | 16.32% | 28.39% |
| 8 | 234080 | JW생명과학 | 18.22% | 25.65% |
| 9 | 114840 | 아이패밀리에스씨 | 12.24% | 37.62% |
| 10 | 383220 | F&F | 14.68% | 28.32% |

#### 공통 종목 (두 전략 모두 선정)
- **알트 (459550)**: 전략A 28위, 전략B 17위

---

### 2. 백테스팅 결과 (2015-2025)

#### 성과 지표 비교

| 지표 | KOSPI (벤치마크) | 전략 A (마법공식) | 전략 B (멀티팩터) |
|------|------------------|-------------------|-------------------|
| **총 수익률** | - | **90.77%** | **102.36%** |
| **CAGR (연복리)** | 7.58% | **11.98%** | **13.15%** |
| **연간 변동성** | - | 17.05% | 19.08% |
| **MDD (최대낙폭)** | -43.90% | **-24.42%** | -33.90% |
| **Sharpe Ratio** | 0.27 | **0.53** | **0.53** |
| **Sortino Ratio** | - | 0.78 | 0.80 |
| **Win Rate** | - | 52.64% | 52.36% |

#### In-Sample vs Out-of-Sample 비교

| 구간 | 기간 | 전략 A CAGR | 전략 A Sharpe | 전략 B CAGR | 전략 B Sharpe |
|------|------|-------------|---------------|-------------|---------------|
| **In-Sample** | 2015-2023 | 3.01% | 0.00 | 7.06% | 0.22 |
| **Out-of-Sample** | 2024-2025 | **67.50%** | **3.27** | **47.71%** | **1.98** |

---

## 핵심 분석

### 1. 벤치마크 대비 초과수익
- 전략 A: KOSPI 대비 연 **+4.4%p** 초과수익
- 전략 B: KOSPI 대비 연 **+5.6%p** 초과수익

### 2. 위험 조정 수익률
- 두 전략 모두 Sharpe 0.53으로 동일
- 전략 A가 MDD 측면에서 더 안정적 (-24.4% vs -33.9%)

### 3. 과적합 검증 (IS/OOS)
- **전략 A**: OOS에서 오히려 더 좋은 성과 (CAGR 67.5%, Sharpe 3.27)
- **전략 B**: OOS에서도 양호한 성과 유지 (CAGR 47.7%, Sharpe 1.98)
- 두 전략 모두 과적합 우려 낮음

### 4. 전략별 특성
- **전략 A (마법공식)**: 낮은 변동성, 낮은 MDD → 보수적 투자자에 적합
  - 코스닥 60% 비중으로 정부 코스닥 3000 정책 수혜 기대
  - 중소형 가치주 중심, 평균 시총 3.7조원
- **전략 B (멀티팩터)**: 높은 수익률, 높은 변동성 → 공격적 투자자에 적합
  - 메가캡 KOSPI 100%, 평균 시총 95조원
  - Quality 팩터(40%)가 대형 안정주 선호

### 5. 코스닥 3000 정책 대응 전략
- **정부 목표**: 코스닥 지수 3000 달성 (현재 ~750)
- **추천**: 전략 A (코스닥 18개 종목) 또는 TIGER 코스닥150 하이브리드
- **전략 C 실패 교훈**: 정부 정책만 믿고 펀더멘털 무시하면 실패
- **최적 접근**: 전략 A 코스닥 18개 (펀더멘털 우수) + 시장 상승 수혜

---

## 출력 파일 목록

### 현재 포트폴리오 (`output/`)
- `portfolio_2026_01_strategy_a.csv` - 마법공식 30종목
- `portfolio_2026_01_strategy_b.csv` - 멀티팩터 30종목
- `portfolio_2026_01_report.txt` - 분석 리포트

### 백테스트 결과 (`backtest_results/`)
- `backtest_strategy_A_metrics.json` - 전략 A 성과 지표
- `backtest_strategy_A_returns.csv` - 전략 A 일별 수익률
- `backtest_strategy_A_cumulative.csv` - 전략 A 누적 수익률
- `backtest_strategy_A_history.csv` - 전략 A 리밸런싱 이력
- `backtest_strategy_B_*.csv/json` - 전략 B 동일 구조
- `backtest_benchmark_returns.csv` - KOSPI 벤치마크
- `backtest_comparison.csv` - 전략 비교 요약

---

## 실행 방법

```bash
# 현재 포트폴리오 생성
python create_current_portfolio.py

# 전체 백테스팅 실행
python full_backtest.py

# 시각화 (개발 중)
python visualize_backtest.py
```

---

## 기술 스택

- **언어**: Python 3.13
- **주요 라이브러리**:
  - `pykrx 1.2.3`: 한국 주식 데이터 API
  - `pandas 2.2.3`: 데이터 처리
  - `numpy`: 수치 계산
  - `requests`: HTTP 요청
- **데이터 소스**:
  - KRX (한국거래소): 시가총액, 펀더멘털
  - FnGuide: 재무제표 (웹 크롤링)

---

## 생성일
2026-01-30
